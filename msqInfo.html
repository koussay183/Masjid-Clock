<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/styleInfo.css">
    <!-- <script type="module" src="infoFire.js"></script> -->
</head>

<body>
    <div class="wrapper">
        <div class="title-text">
            <div class="title info">إعدادات المسجد</div>
        </div>
        <div class="form-container">
            <div class="form-inner">
                <form action="#" class="info">
                    <div class="field">
                        البريد الإلكتروني<input type="text" placeholder="Email Address" id="email" >
                    </div>
                   
                    <div class="field">
                        كلمة السر
                        <input type="password" placeholder="Password" id="pass" >
                        <span data-target="pass" class="toggle-password">👁️</span>
                    </div>
                 
                    <div class="field">
                        رقم الجوال
                        <input type="text" placeholder="Mobile (05XXXXXXXX)" id="mobile" required>
                    </div>
                    <div class="field">
                        إسم المسجد
                        <input type="text" placeholder="Mosque Name" id="msqName" required>

                    </div>
                    <div class="field">
                        خط العرض
                        <input type="text" placeholder="Latitude" id="lat" required>

                    </div>
                    <div class="field">
                        خط الطول
                        <input type="text" placeholder="Longtitude" id="long" required>

                    </div>
                    <div class="field">
                        فترة الفجر
                        <input type="number" placeholder="fajr duration" id="fajr" required>

                    </div>
                    <div class="field">
                        فترة الشروق
                        <input type="number" placeholder="sunrise duration" id="sunrise" required>

                    </div>
                    <div class="field">
                        فترة الظهر
                        <input type="number" placeholder="dhuhr duration" id="dhuhr" required>

                    </div>
                    <div class="field">
                        فترة العصر
                        <input type="number" placeholder="asr duration" id="asr" required>

                    </div>
                    <div class="field">
                        فترة المغرب
                        <input type="number" placeholder="maghrib duration" id="maghrib" required>

                    </div>
                    <div class="field">
                        فترة العشاء
                        <input type="number" placeholder="isha duration" id="isha" required>

                    </div>
                    <div class="field">
                        الأحاديث
                        <input type="text" placeholder="hadeeth" id="hadeeth" required>

                    </div>
                    <div class="field">
                        الإعلانات
                        <input type="text" placeholder="advertisement" id="advertisement">

                    </div>
                    <div class="field">
                        شكل الشاشة
                        <input type="text" id="screen" placeholder="write H or V" name="screen" required>
                    </div>
                    <div class="field btn">
                        <div class="btn-layer"></div>
                        <input type="submit" value="تأكيد" id="infobtn">
                    </div>

                </form>

            </div>
        </div>
    </div>


    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        // import { recordRef } from './signupFire.js';

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAoO1sTD7c29cXuf7Ym2EFWFWf4sT-dhGQ",
            authDomain: "manarahclock.firebaseapp.com",
            projectId: "manarahclock",
            storageBucket: "manarahclock.appspot.com",
            messagingSenderId: "787657770789",
            appId: "1:787657770789:web:028b6a3eb9cc7a32827ccc"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // get ref to database services
        const db = getDatabase(app);

        const email = document.getElementById("email");
        const password = document.getElementById("pass");
        const mobile = document.getElementById("mobile");
        const msqNameF = document.getElementById("msqName");
        const lat = document.getElementById("lat");
        const long = document.getElementById("long");
        const fajrD = document.getElementById("fajr");
        const sunriseD = document.getElementById("sunrise");
        const dhuhrD = document.getElementById("dhuhr");
        const asrD = document.getElementById("asr");
        const maghribD = document.getElementById("maghrib");
        const ishaD = document.getElementById("isha");
        const hadeeth = document.getElementById("hadeeth");
        const advertisement = document.getElementById("advertisement");
        const screen = document.getElementById("screen");

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Get the parameter value from the URL
        const parameterValue = getParameterByName('parameter');

        // Example usage: Display the parameter value in an alert

        // console.log('Parameter value received: ' + parameterValue);
        var refRec = ref(db, `users/${parameterValue}`);
        get(refRec).then((snapshot) => {
            let databaseValue = snapshot.val();
            console.log(databaseValue);

            email.value = databaseValue.email;
            password.value = databaseValue.password;
            mobile.value = databaseValue.mobile;
            msqNameF.value = databaseValue.msqname;
            lat.value = databaseValue.lat;
            long.value = databaseValue.long;
            fajrD.value = databaseValue.fajr;
            sunriseD.value = databaseValue.sunrise;
            dhuhrD.value = databaseValue.dhuhr;
            asrD.value = databaseValue.asr;
            maghribD.value = databaseValue.maghrib;
            ishaD.value = databaseValue.isha;
            hadeeth.value = databaseValue.hadeeth;
            advertisement.value = databaseValue.advertisement;
            screen.value = databaseValue.screen


        }).catch((error) => {
            console.error("Error getting data:", error);
        });






        document.getElementById('infobtn').addEventListener('click', async function (e) {
            e.preventDefault();

            // const emailInfo = document.getElementById("email");
            // const passwordInfo = document.getElementById("pass");
            // const msqNameInfo = document.getElementById("msqName");
            // const latInfo = document.getElementById("lat");
            // const longInfo = document.getElementById("long");
            // const fajrInfo = document.getElementById("fajr");
            // const dhuhrInfo = document.getElementById("dhuhr");
            // const asrInfo = document.getElementById("asr");
            // const maghribInfo = document.getElementById("maghrib");
            // const ishaInfo = document.getElementById("isha");
            // const hadeethInfo = document.getElementById("hadeeth");
            // const advertisementInfo = document.getElementById("advertisement");

            // console.log(databaseValue);
            const newData = {
                    email: document.getElementById('email').value,
                    password: document.getElementById('pass').value,
                    mobile: document.getElementById('mobile').value,
                    msqname: document.getElementById('msqName').value,
                    lat: document.getElementById('lat').value,
                    long: document.getElementById('long').value,
                    fajr: document.getElementById('fajr').value,
                    sunrise: document.getElementById('sunrise').value,
                    dhuhr: document.getElementById('dhuhr').value,
                    asr: document.getElementById('asr').value,
                    maghrib: document.getElementById('maghrib').value,
                    isha: document.getElementById('isha').value,
                    hadeeth: document.getElementById('hadeeth').value,
                    advertisement: document.getElementById('advertisement').value,
                    screen : document.getElementById('screen').value
                }
                console.log(newData);
            let x = await set(ref(db, 'users/' + document.getElementById("email").value.split("@")[0].replace(/[.#$\[\]]/g, "")),
                newData
            );
            console.log(x);
            alert("تم تحديث البيانات بنجاح")
            var destination = 'clock.html?parameter=' + encodeURIComponent(`${document.getElementById('email').value.split("@")[0].replace(/[.#$\[\]]/g, "")}`);
            window.location.href = destination;

        });



    </script>
    <script src="js/signinup.js"></script>

</body>

</html>