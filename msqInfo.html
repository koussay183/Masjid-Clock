<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/styleInfo.css">
    <!-- <script type="module" src="infoFire.js"></script> -->
</head>

<body>
    <div class="wrapper">
        <div class="title-text">
            <div class="title info">إعدادات المسجد</div>
        </div>
        <div class="form-container">
            <div class="form-inner">
                <form action="#" class="info">
                    <div class="field">
                        البريد الإلكتروني<input type="text" placeholder="Email Address" id="email" >
                    </div>
                   
                    <div class="field">
                        كلمة السر
                        <input type="password" placeholder="Password" id="pass" >
                        <span data-target="pass" class="toggle-password">👁️</span>
                    </div>
                 
                    <div class="field">
                        رقم الجوال
                        <input type="text" placeholder="Mobile (05XXXXXXXX)" id="mobile" required>
                    </div>
                    <div class="field">
                        إسم المسجد
                        <input type="text" placeholder="Mosque Name" id="msqName" required>

                    </div>
                    <div class="field">
                        خط العرض
                        <input type="text" placeholder="Latitude" id="lat" required>

                    </div>
                    <div class="field">
                        خط الطول
                        <input type="text" placeholder="Longtitude" id="long" required>

                    </div>
                    <div class="field">
                        فترة الفجر
                        <input type="number" placeholder="fajr duration" id="fajr" required>

                    </div>
                    <div class="field">
                        فترة الشروق
                        <input type="number" placeholder="sunrise duration" id="sunrise" required>

                    </div>
                    <div class="field">
                        فترة الظهر
                        <input type="number" placeholder="dhuhr duration" id="dhuhr" required>

                    </div>
                    <div class="field">
                        فترة العصر
                        <input type="number" placeholder="asr duration" id="asr" required>

                    </div>
                    <div class="field">
                        فترة المغرب
                        <input type="number" placeholder="maghrib duration" id="maghrib" required>

                    </div>
                    <div class="field">
                        فترة العشاء
                        <input type="number" placeholder="isha duration" id="isha" required>

                    </div>
                    <div class="field">
                        الأحاديث
                        <input type="text" placeholder="hadeeth" id="hadeeth" required>

                    </div>
                    <div class="field">
                        الإعلانات
                        <input type="text" placeholder="advertisement" id="advertisement">

                    </div>
                    <div class="field">
                        شكل الشاشة
                        <input type="text" id="screen" placeholder="write H or V" name="screen" required>
                    </div>
                    <div class="field btn">
                        <div class="btn-layer"></div>
                        <input type="submit" value="تأكيد" id="infobtn">
                    </div>

                </form>

            </div>
        </div>
    </div>


    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        // import { recordRef } from './signupFire.js';
    
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAoO1sTD7c29cXuf7Ym2EFWFWf4sT-dhGQ",
            authDomain: "manarahclock.firebaseapp.com",
            projectId: "manarahclock",
            storageBucket: "manarahclock.appspot.com",
            messagingSenderId: "787657770789",
            appId: "1:787657770789:web:028b6a3eb9cc7a32827ccc"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
    
        // get ref to database services
        const db = getDatabase(app);
    
        const email = document.getElementById("email");
        const password = document.getElementById("pass");
        const mobile = document.getElementById("mobile");
        const msqNameF = document.getElementById("msqName");
        const lat = document.getElementById("lat");
        const long = document.getElementById("long");
        const fajrD = document.getElementById("fajr");
        const sunriseD = document.getElementById("sunrise");
        const dhuhrD = document.getElementById("dhuhr");
        const asrD = document.getElementById("asr");
        const maghribD = document.getElementById("maghrib");
        const ishaD = document.getElementById("isha");
        const hadeeth = document.getElementById("hadeeth");
        const advertisement = document.getElementById("advertisement");
        const screen = document.getElementById("screen");
    
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
    
        // Get the parameter value from the URL
        const parameterValue = getParameterByName('parameter');
    
        // Example usage: Display the parameter value in an alert
        // console.log('Parameter value received: ' + parameterValue);
        var refRec = ref(db, `users/${parameterValue}`);
        get(refRec).then((snapshot) => {
            if (snapshot.exists()) {
                let databaseValue = snapshot.val();
                console.log(databaseValue);
    
                email.value = databaseValue.email;
                password.value = databaseValue.password;
                mobile.value = databaseValue.mobile;
                msqNameF.value = databaseValue.msqname;
                lat.value = databaseValue.lat;
                long.value = databaseValue.long;
                fajrD.value = databaseValue.fajr;
                sunriseD.value = databaseValue.sunrise;
                dhuhrD.value = databaseValue.dhuhr;
                asrD.value = databaseValue.asr;
                maghribD.value = databaseValue.maghrib;
                ishaD.value = databaseValue.isha;
                hadeeth.value = databaseValue.hadeeth;
                advertisement.value = databaseValue.advertisement;
                screen.value = databaseValue.screen;
            } else {
                console.error("No data available");
            }
        }).catch((error) => {
            console.error("Error getting data:", error);
        });
    
        document.getElementById('infobtn').addEventListener('click', async function (e) {
            e.preventDefault();
    
            const newData = {
                email: email.value,
                password: password.value,
                mobile: mobile.value,
                msqname: msqNameF.value,
                lat: lat.value,
                long: long.value,
                fajr: fajrD.value,
                sunrise: sunriseD.value,
                dhuhr: dhuhrD.value,
                asr: asrD.value,
                maghrib: maghribD.value,
                isha: ishaD.value,
                hadeeth: hadeeth.value,
                advertisement: advertisement.value,
                screen: screen.value
            };
    
            console.log('Updating data for user:', newData.email.split("@")[0].replace(/[.#$\[\]]/g, ""));
            console.log('Data:', newData);
    
            try {
                await set(ref(db, 'users/' + newData.email.split("@")[0].replace(/[.#$\[\]]/g, "")), newData);
                console.log('Data successfully updated');
                alert("تم تحديث البيانات بنجاح");
                var destination = 'clock.html?parameter=' + encodeURIComponent(newData.email.split("@")[0].replace(/[.#$\[\]]/g, ""));
                window.location.href = destination;
            } catch (error) {
                console.error('Error updating data:', error);
            }
        });
    </script>
    <script src="js/signinup.js"></script>
    
    <script src="js/signinup.js"></script>

</body>

</html>